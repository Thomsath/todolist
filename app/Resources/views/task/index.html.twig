{% extends 'base.html.twig' %}
{% block title %}{% endblock %}
    
{% block body %}
	<div id="users" class="users">
		<button onclick="toggleActiv()" class="users__button">Trier par user â†’</button>
		<ul class="users__list">
		{% for user in users %}
			<li class="users__item"><a class="users__user" href="{{ path('sortByUser', {'id': user.id }) }}">{{ user.name }}</a></li>
		{% endfor %}
		</ul>
	</div>

	<div class="tri">
	{%  if form is defined %}
		{{ form_start(form) }}
		{{ form_widget(form) }}
		{{ form_end(form) }}
	{%  endif %}
	</div>

	<div class="tasks">
		<ul class="tasks__list">
{% for task in tasks %}
	<li class="tasks__item">
		<div class="tasks__content">
			<h2 class="tasks__title">{{ task.title }}</h2>
			<p>{{ task.content }}</p>
			<p class="tasks__name">{{ task.user.getName() }}</p>
			{% if( task.done == 0) %}
				<p class="tasks__done">A faire</p>
			{% else %}
				<p class="tasks__done">Fait</p>
			{% endif %}
		</div>
		<div class="tasks__buttons">
			<a class="tasks__button" href="{{ path('deleteTask', {'id': task.id}) }}">Supprimer la tache</a>
			<a class="tasks__button" href="{{ path('editTask', {'id': task.id}) }}">Modifier la tache</a>
		</div>
	</li>
{% endfor %}
</ul>
</div>
	{% block javascripts %}
		<script>
			function toggleActiv() {
				jQuery('#users').toggleClass('activ');
			}
			document.getElementsByClassName('nav__link').innerHTML += 'k';
			jQuery(document).ready( function() {
			    const list = document.getElementsByClassName('tasks__list');
                $('#sort_form_tasks').submit(function (e) {
                    e.preventDefault();
                    var content = $( ".SortStatus" ).val();
                    $.ajax({
                        type: 'POST',
                        url: "{{ path('homepage') }}",
						dataType: "json",
                        data: {
                            "selectValue" : content
						},
						async: true,
						success: function(data) {
                            const list = $('.tasks__list');
                            list.empty();
							for(var key in data.task) {
								const contentbefore = $('.tasks__list').html();

                                list.innerHTML += '<li class="tasks__item"> <div class="tasks__content"> ';
							    var title = data.task[key]['title'];
								list.innerHTML += '<h2 class="tasks__title">' + title + '</h2>';

                                var content = data.task[key]['content'];
                                list.innerHTML += '<p>' + content + '</p>';

                                var user = data.task[key]['user'];
                                list.innerHTML += '<p class="tasks__name">' + user + '</p>';

                                var done = data.task[key]['done'];
                                done ? doneContent = 'Fait' : doneContent = 'A faire';
                                var priority = data.task[key]['priority'];
                                list.html(contentbefore + '<li class="tasks__item"> <div class="tasks__content">' +
									'<h2 class="tasks__title">' + title + '</h2>' +
									'<p>' + content + '</p>' +
									'<p class="tasks__name">' + user + '</p>' +
									'<p class="tasks__done">' + doneContent +'</p>');
							}
						}

                    });
                    e.stopImmediatePropagation();
                    return false;
                });
            })
		</script>
	{% endblock %}
{% endblock %}
